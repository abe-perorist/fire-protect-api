<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‚ä¸Šãƒªã‚¹ã‚¯åˆ†æãƒ„ãƒ¼ãƒ« - ä¼æ¥­å‘ã‘ãƒªã‚¹ã‚¯è¨ºæ–­ã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;500;600;700&family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            /* æ¨©å¨çš„ãªã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ - æ¿ƒç´ºãƒ»ã‚°ãƒ¬ãƒ¼ãƒ»ç™½åŸºèª¿ */
            --navy-50: #f8fafc;
            --navy-100: #f1f5f9;
            --navy-200: #e2e8f0;
            --navy-300: #cbd5e1;
            --navy-400: #94a3b8;
            --navy-500: #64748b;
            --navy-600: #475569;
            --navy-700: #334155;
            --navy-800: #1e293b;
            --navy-900: #0f172a;
            
            --deep-navy: #1a2332;
            --dark-navy: #2d3748;
            --medium-navy: #4a5568;
            --light-navy: #718096;
            --pale-navy: #a0aec0;
            
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            
            /* è­¦å‘Šè‰²ï¼ˆé™å®šçš„ä½¿ç”¨ï¼‰ */
            --warning-500: #f59e0b;
            --warning-600: #d97706;
            --danger-500: #ef4444;
            --danger-600: #dc2626;
            --success-500: #10b981;
            --success-600: #059669;
            
            /* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ */
            --accent-blue: #3b82f6;
            --accent-indigo: #6366f1;
            
            /* ã‚¹ãƒšãƒ¼ã‚·ãƒ³ã‚° */
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            --space-10: 2.5rem;
            --space-12: 3rem;
            --space-16: 4rem;
            --space-20: 5rem;
            --space-24: 6rem;
            
            /* ãƒœãƒ¼ãƒ€ãƒ¼ãƒ©ãƒ‡ã‚£ã‚¦ã‚¹ */
            --radius-sm: 0.125rem;
            --radius-md: 0.375rem;
            --radius-lg: 0.5rem;
            --radius-xl: 0.75rem;
            --radius-2xl: 1rem;
            --radius-3xl: 1.5rem;
            --radius-full: 9999px;
            
            /* ã‚·ãƒ£ãƒ‰ã‚¦ï¼ˆå¼±ã‚ï¼‰ */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 2px 4px -1px rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.06);
            --shadow-lg: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -1px rgb(0 0 0 / 0.06);
            --shadow-xl: 0 8px 10px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.05);
            
            /* ãƒ†ã‚­ã‚¹ãƒˆã‚«ãƒ©ãƒ¼ */
            --text-primary: var(--navy-900);
            --text-secondary: var(--navy-700);
            --text-muted: var(--navy-500);
            --text-light: var(--navy-400);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: linear-gradient(135deg, var(--navy-50) 0%, var(--gray-50) 100%);
            min-height: 100vh;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(26, 35, 50, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(45, 55, 72, 0.03) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }
        
        /* ã‚³ãƒ³ãƒ†ãƒŠ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--space-6);
        }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .header {
            text-align: center;
            margin-bottom: var(--space-12);
            padding: var(--space-8) 0;
        }
        
        .header-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--space-6);
            background: linear-gradient(135deg, var(--deep-navy), var(--dark-navy));
            border-radius: var(--radius-2xl);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-lg);
            position: relative;
        }
        
        .header-icon::before {
            content: 'ğŸ›¡ï¸';
            font-size: 2rem;
            filter: grayscale(100%) brightness(0) invert(1);
        }
        
        .header-title {
            font-family: 'Noto Serif JP', serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--deep-navy);
            margin-bottom: var(--space-2);
            letter-spacing: -0.02em;
        }
        
        .header-subtitle {
            font-size: 1.125rem;
            color: var(--text-secondary);
            font-weight: 400;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* ã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .card {
            background: white;
            border: 1px solid var(--navy-200);
            border-radius: var(--radius-xl);
            padding: var(--space-8);
            margin-bottom: var(--space-8);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
        }
        
        .card:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--navy-300);
        }
        
        .card-header {
            margin-bottom: var(--space-6);
        }
        
        .card-title {
            font-family: 'Noto Serif JP', serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--deep-navy);
            margin-bottom: var(--space-2);
        }
        
        .card-subtitle {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        /* å…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .input-section {
            position: relative;
        }
        
        .input-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--space-3);
            font-size: 1rem;
        }
        
        .input-label i {
            margin-right: var(--space-2);
            color: var(--accent-blue);
        }
        
        .text-input {
            width: 100%;
            min-height: 120px;
            padding: var(--space-4);
            border: 2px solid var(--navy-200);
            border-radius: var(--radius-lg);
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 1rem;
            line-height: 1.6;
            resize: vertical;
            transition: all 0.3s ease;
            background: var(--navy-50);
        }
        
        .text-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            background: white;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .char-counter {
            position: absolute;
            bottom: var(--space-2);
            right: var(--space-3);
            font-size: 0.75rem;
            color: var(--text-muted);
            background: white;
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-sm);
            border: 1px solid var(--navy-200);
        }
        
        .char-counter.warning {
            color: var(--warning-600);
            border-color: var(--warning-500);
        }
        
        .char-counter.danger {
            color: var(--danger-600);
            border-color: var(--danger-500);
        }
        
        /* åˆ†æãƒœã‚¿ãƒ³ */
        .analyze-btn {
            width: 100%;
            padding: var(--space-4) var(--space-6);
            background: linear-gradient(135deg, var(--deep-navy), var(--dark-navy));
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .analyze-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .analyze-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .analyze-btn i {
            margin-right: var(--space-2);
        }
        
        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
        .loading {
            display: none;
            text-align: center;
            padding: var(--space-8);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--navy-200);
            border-top: 4px solid var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto var(--space-4);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        /* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .error-message {
            display: none;
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: var(--danger-600);
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-6);
        }
        
        /* çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .result-section {
            display: none;
        }
        
        .result-header {
            text-align: center;
            margin-bottom: var(--space-8);
        }
        
        .result-title {
            font-family: 'Noto Serif JP', serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--deep-navy);
            margin-bottom: var(--space-4);
        }
        
        /* ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢è¡¨ç¤º */
        .risk-score-display {
            text-align: center;
            margin-bottom: var(--space-8);
        }
        
        .score-circle {
            width: 200px;
            height: 200px;
            margin: 0 auto var(--space-6);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .score-circle svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }
        
        .score-circle-bg {
            fill: none;
            stroke: var(--navy-200);
            stroke-width: 8;
        }
        
        .score-circle-progress {
            fill: none;
            stroke-width: 8;
            stroke-linecap: round;
            transition: stroke-dasharray 0.5s ease;
        }
        
        .score-circle-progress.low {
            stroke: var(--success-500);
        }
        
        .score-circle-progress.medium {
            stroke: var(--warning-500);
        }
        
        .score-circle-progress.high {
            stroke: var(--danger-500);
        }
        
        .score-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        
        .score-number {
            font-family: 'Noto Serif JP', serif;
            font-size: 3rem;
            font-weight: 700;
            color: var(--deep-navy);
            line-height: 1;
        }
        
        .score-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        /* ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«ãƒãƒƒã‚¸ */
        .risk-level-badge {
            display: inline-block;
            padding: var(--space-3) var(--space-6);
            border-radius: var(--radius-full);
            font-size: 1.125rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-4);
        }
        
        .risk-level-badge.safe {
            background: var(--success-500);
            color: white;
        }
        
        .risk-level-badge.review {
            background: var(--warning-500);
            color: white;
        }
        
        .risk-level-badge.danger {
            background: var(--danger-500);
            color: white;
        }
        
        .risk-level-badge.critical {
            background: var(--danger-600);
            color: white;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* è©³ç´°ã‚¹ã‚³ã‚¢è¡¨ç¤º */
        .detailed-scores {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-8);
        }
        
        .score-item {
            background: var(--navy-50);
            border: 1px solid var(--navy-200);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            text-align: center;
        }
        
        .score-item-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: var(--space-2);
            font-weight: 500;
        }
        
        .score-item-value {
            font-family: 'Noto Serif JP', serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--deep-navy);
        }
        
        .score-item-bar {
            width: 100%;
            height: 4px;
            background: var(--navy-200);
            border-radius: var(--radius-full);
            margin-top: var(--space-2);
            overflow: hidden;
        }
        
        .score-item-progress {
            height: 100%;
            border-radius: var(--radius-full);
            transition: width 0.5s ease;
        }
        
        .score-item-progress.low {
            background: var(--success-500);
        }
        
        .score-item-progress.medium {
            background: var(--warning-500);
        }
        
        .score-item-progress.high {
            background: var(--danger-500);
        }
        
        /* æ¨å¥¨äº‹é … */
        .recommendations {
            margin-bottom: var(--space-8);
        }
        
        .recommendations-title {
            font-family: 'Noto Serif JP', serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--deep-navy);
            margin-bottom: var(--space-4);
        }
        
        .recommendation-item {
            background: var(--navy-50);
            border-left: 4px solid var(--accent-blue);
            padding: var(--space-4);
            margin-bottom: var(--space-3);
            border-radius: 0 var(--radius-lg) var(--radius-lg) 0;
        }
        
        .recommendation-item i {
            color: var(--accent-blue);
            margin-right: var(--space-2);
        }
        
        /* åˆ†æãƒ†ã‚­ã‚¹ãƒˆ */
        .analysis-text {
            background: var(--navy-50);
            border: 1px solid var(--navy-200);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            margin-bottom: var(--space-8);
            line-height: 1.8;
        }
        
        .analysis-text h3 {
            font-family: 'Noto Serif JP', serif;
            color: var(--deep-navy);
            font-size: 1.25rem;
            font-weight: 600;
            margin: var(--space-4) 0 var(--space-2) 0;
            padding-bottom: var(--space-2);
            border-bottom: 2px solid var(--navy-200);
        }
        
        .analysis-text h4 {
            color: var(--text-secondary);
            font-size: 1.125rem;
            font-weight: 600;
            margin: var(--space-3) 0 var(--space-2) 0;
        }
        
        .analysis-text p {
            margin: var(--space-2) 0;
        }
        
        .analysis-text ul {
            margin: var(--space-2) 0;
            padding-left: var(--space-6);
        }
        
        .analysis-text li {
            margin: var(--space-1) 0;
        }
        
        .analysis-text strong {
            color: var(--deep-navy);
            font-weight: 600;
        }
        
        /* è©³ç´°åˆ†æãƒ¬ãƒãƒ¼ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° */
        .detailed-analysis-section {
            margin-top: var(--space-8);
            padding: var(--space-6);
            background: linear-gradient(135deg, var(--navy-50), var(--gray-50));
            border-radius: var(--radius-xl);
            border: 1px solid var(--navy-200);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        
        .detailed-analysis-section h3 {
            font-family: 'Noto Serif JP', serif;
            color: var(--deep-navy);
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: var(--space-8);
            text-align: center;
            position: relative;
            padding: var(--space-4) 0;
        }
        
        .detailed-analysis-section h3::before {
            content: 'ğŸ“Š';
            display: block;
            font-size: 2rem;
            margin-bottom: var(--space-3);
            opacity: 0.8;
        }
        
        .detailed-analysis-section h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-indigo));
            border-radius: var(--radius-full);
        }
        
        .analysis-section {
            background: white;
            border: 1px solid var(--navy-200);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            margin-bottom: var(--space-5);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .analysis-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--accent-blue), var(--accent-indigo));
            transition: width 0.3s ease;
        }
        
        .analysis-section:hover {
            border-color: var(--accent-blue);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
            transform: translateY(-2px);
        }
        
        .analysis-section:hover::before {
            width: 6px;
        }
        
        .analysis-section h4 {
            font-family: 'Noto Serif JP', serif;
            color: var(--deep-navy);
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: var(--space-4);
            padding-bottom: var(--space-3);
            border-bottom: 2px solid var(--navy-100);
            position: relative;
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .analysis-section h4::before {
            content: '';
            width: 8px;
            height: 8px;
            background: var(--accent-blue);
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .analysis-section p {
            color: var(--text-primary);
            line-height: 1.8;
            margin-bottom: var(--space-3);
            font-size: 1rem;
        }
        
        .analysis-section ul {
            margin: var(--space-4) 0;
            padding-left: 0;
            list-style: none;
        }
        
        .analysis-section li {
            color: var(--text-primary);
            margin: var(--space-3) 0;
            line-height: 1.7;
            position: relative;
            padding-left: var(--space-6);
            font-size: 1rem;
        }
        
        .analysis-section li::before {
            content: 'â–¶';
            position: absolute;
            left: 0;
            color: var(--accent-blue);
            font-size: 0.8rem;
            top: 0.1em;
        }
        
        .analysis-section ol {
            margin: var(--space-4) 0;
            padding-left: 0;
            counter-reset: item;
        }
        
        .analysis-section ol li {
            color: var(--text-primary);
            margin: var(--space-3) 0;
            line-height: 1.7;
            position: relative;
            padding-left: var(--space-8);
            counter-increment: item;
            font-size: 1rem;
        }
        
        .analysis-section ol li::before {
            content: counter(item);
            position: absolute;
            left: 0;
            top: 0;
            background: var(--accent-blue);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .analysis-section.conclusion {
            background: white;
            border: 2px solid var(--accent-blue);
            position: relative;
            overflow: hidden;
        }
        
        .analysis-section.conclusion::before {
            background: var(--accent-blue);
            width: 6px;
        }
        
        .analysis-section.conclusion::after {
            content: 'ğŸ¯';
            position: absolute;
            top: var(--space-4);
            right: var(--space-4);
            font-size: 1.5rem;
            opacity: 0.3;
        }
        
        .analysis-section.conclusion h4 {
            color: var(--accent-blue);
            border-bottom-color: var(--accent-blue);
        }
        
        .analysis-section.conclusion h4::before {
            background: var(--accent-blue);
            width: 10px;
            height: 10px;
        }
        
        .analysis-section.conclusion p {
            color: var(--text-primary);
            font-size: 1.05rem;
            line-height: 1.8;
            font-weight: 500;
        }
        
        .analysis-section.conclusion:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
            border-color: var(--accent-indigo);
        }
        
        /* é–¢é€£äº‹ä¾‹ */
        .related-cases {
            margin-bottom: var(--space-8);
        }
        
        .related-cases-title {
            font-family: 'Noto Serif JP', serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--deep-navy);
            margin-bottom: var(--space-4);
        }
        
        .case-item {
            background: white;
            border: 1px solid var(--navy-200);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-bottom: var(--space-3);
            transition: all 0.3s ease;
        }
        
        .case-item:hover {
            border-color: var(--navy-300);
            box-shadow: var(--shadow-sm);
        }
        
        .case-title {
            font-weight: 600;
            color: var(--deep-navy);
            margin-bottom: var(--space-2);
        }
        
        .case-meta {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: var(--space-2);
        }
        
        .case-description {
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        /* ãƒ•ãƒƒã‚¿ãƒ¼ */
        .footer {
            text-align: center;
            padding: var(--space-8) 0;
            border-top: 1px solid var(--navy-200);
            margin-top: var(--space-12);
            color: var(--text-secondary);
        }
        
        .footer-brand {
            font-family: 'Noto Serif JP', serif;
            font-weight: 600;
            color: var(--deep-navy);
            margin-bottom: var(--space-2);
        }
        
        .footer-version {
            font-size: 0.875rem;
            color: var(--text-muted);
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ */
        @media (max-width: 768px) {
            .container {
                padding: var(--space-4);
            }
            
            .header-title {
                font-size: 2rem;
            }
            
            .card {
                padding: var(--space-6);
            }
            
            .score-circle {
                width: 150px;
                height: 150px;
            }
            
            .score-number {
                font-size: 2rem;
            }
            
            .detailed-scores {
                grid-template-columns: 1fr;
            }
        }
        
        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--navy-100);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--navy-400);
            border-radius: var(--radius-full);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--navy-500);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <header class="header">
            <div class="header-icon"></div>
            <h1 class="header-title">ç‚ä¸Šãƒªã‚¹ã‚¯åˆ†æãƒ„ãƒ¼ãƒ«</h1>
            <p class="header-subtitle">ä¼æ¥­å‘ã‘ãƒªã‚¹ã‚¯è¨ºæ–­ã‚·ã‚¹ãƒ†ãƒ  - æŠ•ç¨¿å‰ã®ãƒªã‚¹ã‚¯ã‚’ç§‘å­¦çš„ã«åˆ†æã—ã€é©åˆ‡ãªå¯¾å¿œç­–ã‚’ææ¡ˆã—ã¾ã™</p>
        </header>

        <!-- å…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="card input-section">
            <div class="card-header">
                <h2 class="card-title">åˆ†æå¯¾è±¡ãƒ†ã‚­ã‚¹ãƒˆ</h2>
                <p class="card-subtitle">æŠ•ç¨¿äºˆå®šã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆæœ€å¤§1000æ–‡å­—ï¼‰</p>
            </div>
            
            <label for="textInput" class="input-label">
                <i class="fas fa-edit"></i>
                ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›
            </label>
            <textarea 
                id="textInput" 
                class="text-input" 
                placeholder="åˆ†æã—ãŸã„ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."
                maxlength="1000"
            ></textarea>
            <div class="char-counter" id="charCounter">0 / 1000</div>
            
            <button id="analyzeBtn" class="analyze-btn">
                <i class="fas fa-shield-alt"></i>
                ãƒªã‚¹ã‚¯åˆ†æã‚’å®Ÿè¡Œ
            </button>
        </div>

        <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
        <div class="loading" id="loading">
            <div class="loading-spinner"></div>
            <p class="loading-text">AIåˆ†æã‚’å®Ÿè¡Œä¸­ã§ã™...</p>
        </div>

        <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
        <div class="error-message" id="errorMessage"></div>

        <!-- çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="result-section" id="resultSection">
            <div class="result-header">
                <h2 class="result-title">åˆ†æçµæœ</h2>
            </div>

            <!-- ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢è¡¨ç¤º -->
            <div class="card risk-score-display">
                <div class="score-circle" id="scoreCircle">
                    <svg viewBox="0 0 100 100">
                        <circle class="score-circle-bg" cx="50" cy="50" r="40"></circle>
                        <circle class="score-circle-progress" cx="50" cy="50" r="40" id="scoreProgress"></circle>
                    </svg>
                    <div class="score-text">
                        <div class="score-number" id="scoreNumber">0</div>
                        <div class="score-label">ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢</div>
                    </div>
                </div>
                
                <div class="risk-level-badge" id="riskLevelBadge">åˆ†æä¸­</div>
                <p id="riskDescription">åˆ†æçµæœã«åŸºã¥ããƒªã‚¹ã‚¯è©•ä¾¡</p>
            </div>

            <!-- è©³ç´°ã‚¹ã‚³ã‚¢ -->
            <div class="card">
                <h3 class="card-title">è©³ç´°åˆ†æçµæœ</h3>
                <div class="detailed-scores" id="detailedScores">
                    <!-- JavaScript ã§å‹•çš„ç”Ÿæˆ -->
                </div>
            </div>

            <!-- æ¨å¥¨äº‹é … -->
            <div class="card recommendations">
                <h3 class="recommendations-title">æ¨å¥¨äº‹é …</h3>
                <div id="recommendationsList">
                    <!-- JavaScript ã§å‹•çš„ç”Ÿæˆ -->
                </div>
            </div>

            <!-- åˆ†æãƒ†ã‚­ã‚¹ãƒˆ -->
            <div class="card">
                <h3 class="card-title">è©³ç´°åˆ†æãƒ¬ãƒãƒ¼ãƒˆ</h3>
                <div class="analysis-text" id="analysisText">
                    <!-- JavaScript ã§å‹•çš„ç”Ÿæˆ -->
                </div>
            </div>

            <!-- é–¢é€£äº‹ä¾‹ -->
            <div class="card related-cases">
                <h3 class="related-cases-title" id="relatedCasesTitle">é–¢é€£ã™ã‚‹ç‚ä¸Šäº‹ä¾‹</h3>
                <div id="relatedCasesList">
                    <!-- JavaScript ã§å‹•çš„ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer class="footer">
        <div class="footer-brand">ãƒªã‚¹ã‚¯åˆ†æãƒ©ãƒœ</div>
        <div class="footer-version">Version 2.0.0 - ä¼æ¥­å‘ã‘ãƒªã‚¹ã‚¯è¨ºæ–­ã‚·ã‚¹ãƒ†ãƒ </div>
    </footer>

    <script>
        // DOMè¦ç´ ã®å–å¾—
        const textInput = document.getElementById('textInput');
        const charCounter = document.getElementById('charCounter');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const loading = document.getElementById('loading');
        const errorMessage = document.getElementById('errorMessage');
        const resultSection = document.getElementById('resultSection');
        const scoreCircle = document.getElementById('scoreCircle');
        const scoreProgress = document.getElementById('scoreProgress');
        const scoreNumber = document.getElementById('scoreNumber');
        const riskLevelBadge = document.getElementById('riskLevelBadge');
        const riskDescription = document.getElementById('riskDescription');
        const detailedScores = document.getElementById('detailedScores');
        const recommendationsList = document.getElementById('recommendationsList');
        const analysisText = document.getElementById('analysisText');
        const relatedCasesList = document.getElementById('relatedCasesList');
        const relatedCasesTitle = document.getElementById('relatedCasesTitle');

        // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
        textInput.addEventListener('input', function() {
            const length = this.value.length;
            charCounter.textContent = `${length} / 1000`;
            
            if (length > 800) {
                charCounter.className = 'char-counter danger';
            } else if (length > 600) {
                charCounter.className = 'char-counter warning';
            } else {
                charCounter.className = 'char-counter';
            }
        });

        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®ç®¡ç†
        function setLoading(isLoading) {
            if (isLoading) {
                loading.style.display = 'block';
                analyzeBtn.disabled = true;
                analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> åˆ†æä¸­...';
            } else {
                loading.style.display = 'none';
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<i class="fas fa-shield-alt"></i> ãƒªã‚¹ã‚¯åˆ†æã‚’å®Ÿè¡Œ';
            }
        }

        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤º
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        function hideError() {
            errorMessage.style.display = 'none';
        }

        // çµæœã®éè¡¨ç¤º
        function hideResult() {
            resultSection.style.display = 'none';
        }

        // å††å½¢ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®æ›´æ–°
        function updateScoreCircle(score) {
            const circumference = 2 * Math.PI * 40;
            const progress = (score / 100) * circumference;
            
            scoreProgress.style.strokeDasharray = `${progress} ${circumference}`;
            scoreNumber.textContent = score;
            
            // ã‚¹ã‚³ã‚¢ã«å¿œã˜ã¦è‰²ã‚’å¤‰æ›´
            scoreProgress.className = 'score-circle-progress';
            if (score >= 70) {
                scoreProgress.classList.add('high');
            } else if (score >= 40) {
                scoreProgress.classList.add('medium');
            } else {
                scoreProgress.classList.add('low');
            }
        }

        // è©³ç´°ã‚¹ã‚³ã‚¢ã®è¡¨ç¤º
        function displayDetailedScores(riskScore) {
            // ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆã§ã¯åŸºæœ¬çš„ãªã‚¹ã‚³ã‚¢ã®ã¿è¡¨ç¤º
            const scores = [
                { label: 'ç·åˆãƒªã‚¹ã‚¯', value: riskScore.overall_score, color: getScoreColor(riskScore.overall_score) },
                { label: 'ä¿¡é ¼åº¦', value: Math.round(riskScore.confidence * 100), color: 'low' }
            ];

            detailedScores.innerHTML = scores.map(score => `
                <div class="score-item">
                    <div class="score-item-label">${score.label}</div>
                    <div class="score-item-value">${score.value}${score.label === 'ä¿¡é ¼åº¦' ? '%' : ''}</div>
                    <div class="score-item-bar">
                        <div class="score-item-progress ${score.color}" style="width: ${score.value}%"></div>
                    </div>
                </div>
            `).join('');
        }

        // ã‚¹ã‚³ã‚¢ã«å¿œã˜ãŸè‰²ã®å–å¾—
        function getScoreColor(score) {
            if (score >= 70) return 'high';
            if (score >= 40) return 'medium';
            return 'low';
        }

        // ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«ã®è¡¨ç¤º
        function displayRiskLevel(riskLevel, recommendation) {
            riskLevelBadge.textContent = riskLevel;
            riskLevelBadge.className = 'risk-level-badge';
            
            if (riskLevel === 'æŠ•ç¨¿å¯') {
                riskLevelBadge.classList.add('safe');
                riskDescription.textContent = 'å®‰å…¨ã«æŠ•ç¨¿ã§ãã¾ã™';
            } else if (riskLevel === 'è¦ãƒ¬ãƒ“ãƒ¥ãƒ¼') {
                riskLevelBadge.classList.add('review');
                riskDescription.textContent = 'æŠ•ç¨¿å‰ã®è¦‹ç›´ã—ãŒå¿…è¦ã§ã™';
            } else if (riskLevel === 'æŠ•ç¨¿å±é™º') {
                riskLevelBadge.classList.add('danger');
                riskDescription.textContent = 'æŠ•ç¨¿ã¯å±é™ºã§ã™';
            } else if (riskLevel === 'å³æ™‚åœæ­¢') {
                riskLevelBadge.classList.add('critical');
                riskDescription.textContent = 'ç›´ã¡ã«æŠ•ç¨¿ã‚’ä¸­æ­¢ã—ã¦ãã ã•ã„';
            }
        }

        // æ¨å¥¨äº‹é …ã®è¡¨ç¤º
        function displayRecommendations(recommendations) {
            recommendationsList.innerHTML = recommendations.map(rec => `
                <div class="recommendation-item">
                    <i class="fas fa-check-circle"></i>
                    ${rec}
                </div>
            `).join('');
        }

        // åˆ†æãƒ†ã‚­ã‚¹ãƒˆã®è¡¨ç¤º
        function displayAnalysisText(text, riskScore, relatedCases) {
            // æ—¢å­˜ã®åˆ†æãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤º
            let html = convertMarkdownToHtml(text);
            
            // ã‚ˆã‚Šè©³ç´°ãªåˆ†æãƒ¬ãƒãƒ¼ãƒˆã‚’è¿½åŠ 
            html += generateDetailedAnalysisReport(text, riskScore, relatedCases);
            
            analysisText.innerHTML = html;
        }

        // è©³ç´°åˆ†æãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ
        function generateDetailedAnalysisReport(originalText, riskScore, relatedCases) {
            // ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢ã«åŸºã¥ãè©³ç´°åˆ†æ
            const overallRisk = getDetailedRiskAssessment(riskScore);
            const contentRisk = getContentRiskAnalysis(originalText, riskScore);
            const legalRisk = getLegalRiskAnalysis(originalText, riskScore);
            const brandRisk = getBrandRiskAnalysis(originalText, riskScore);
            const socialRisk = getSocialRiskAnalysis(originalText, riskScore);
            const riskFactors = analyzeRiskFactors(originalText, riskScore);
            const comparison = getCaseComparison(relatedCases);
            
            return `
                <div class="detailed-analysis-section">
                    <h3>è©³ç´°ãƒªã‚¹ã‚¯åˆ†æãƒ¬ãƒãƒ¼ãƒˆ</h3>
                    
                    <div class="analysis-section">
                        <h4>ç·åˆãƒªã‚¹ã‚¯è©•ä¾¡</h4>
                        <p>${overallRisk}</p>
                    </div>
                    
                    <div class="analysis-section">
                        <h4>åŸå› ã‚«ãƒ†ã‚´ãƒª</h4>
                        <p><strong>${riskScore.category}</strong> - ${getCategoryExplanation(riskScore.category)}</p>
                    </div>
                    
                    <div class="analysis-section">
                        <h4>ãƒªã‚¹ã‚¯è¦å› </h4>
                        <ul>
                            ${riskFactors.map(factor => `<li>${factor}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="analysis-section">
                        <h4>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒªã‚¹ã‚¯åˆ†æ</h4>
                        <p>${contentRisk}</p>
                    </div>
                    
                    <div class="analysis-section">
                        <h4>æ³•çš„ãƒªã‚¹ã‚¯åˆ†æ</h4>
                        <p>${legalRisk}</p>
                    </div>
                    
                    <div class="analysis-section">
                        <h4>ãƒ–ãƒ©ãƒ³ãƒ‰ãƒªã‚¹ã‚¯åˆ†æ</h4>
                        <p>${brandRisk}</p>
                    </div>
                    
                    <div class="analysis-section">
                        <h4>ç¤¾ä¼šçš„ãƒªã‚¹ã‚¯åˆ†æ</h4>
                        <p>${socialRisk}</p>
                    </div>
                    
                    <div class="analysis-section">
                        <h4>é¡ä¼¼äº‹ä¾‹ã¨ã®æ¯”è¼ƒ</h4>
                        <p>${comparison}</p>
                    </div>
                    
                    <div class="analysis-section">
                        <h4>ä¿®æ­£æ¡ˆ</h4>
                        <p>${getRevisionSuggestion(originalText, riskScore)}</p>
                    </div>
                    
                    <div class="analysis-section">
                        <h4>æ”¹å–„ææ¡ˆ</h4>
                        <ol>
                            <li><strong>æŠ•ç¨¿ã®å‰Šé™¤:</strong> ç›´ã¡ã«æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã€å†ç™ºé˜²æ­¢ç­–ã‚’è¬›ã˜ã¾ã™ã€‚</li>
                            <li><strong>è¬ç½ªæ–‡ã®ç™ºè¡¨:</strong> é–¢ä¿‚è€…ã¸ã®è¬ç½ªã¨ã€ä¸é©åˆ‡ãªè¡¨ç¾ã‚’æ·±ãåçœã—ã¦ã„ã‚‹æ—¨ã‚’æ˜ç¢ºã«è¨˜ã—ãŸè¬ç½ªæ–‡ã‚’å…¬é–‹ã—ã¾ã™ã€‚</li>
                            <li><strong>å†ç™ºé˜²æ­¢ç­–ã®ç­–å®š:</strong> ç¤¾å†…è¦å®šã®è¦‹ç›´ã—ã€ç¤¾å“¡æ•™è‚²ã®å¼·åŒ–ãªã©ã€ä¸é©åˆ‡ãªè¡¨ç¾ã‚’å«ã‚€æŠ•ç¨¿ã‚’é˜²ããŸã‚ã®å…·ä½“çš„ãªå¯¾ç­–ã‚’è¬›ã˜ã¾ã™ã€‚</li>
                            <li><strong>ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ä½“åˆ¶ã®å¼·åŒ–:</strong> SNSç­‰ã§ã®ç™ºè¨€ã‚’ç›£è¦–ã—ã€å•é¡Œã®ã‚ã‚‹æŠ•ç¨¿ã‚’æ—©æœŸã«ç™ºè¦‹ãƒ»å¯¾å¿œã§ãã‚‹ä½“åˆ¶ã‚’æ•´ãˆã¾ã™ã€‚</li>
                            <li><strong>å°‚é–€å®¶ã¸ã®ç›¸è«‡:</strong> å¿…è¦ã«å¿œã˜ã¦ã€å¼è­·å£«ã‚„PRå°‚é–€å®¶ãªã©ã«ç›¸è«‡ã—ã€é©åˆ‡ãªå¯¾å¿œã‚’è¡Œã„ã¾ã™ã€‚</li>
                        </ol>
                    </div>
                    
                    <div class="analysis-section conclusion">
                        <h4>çµè«–</h4>
                        <p>${getConclusion(riskScore)}</p>
                    </div>
                </div>
            `;
        }

        // ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ½å‡º
        function extractKeywordsFromText(text) {
            const keywords = [];
            const highRiskWords = ['å·®åˆ¥', 'æ”»æ’ƒ', 'æš´åŠ›çš„', 'ä¸é©åˆ‡', 'èª¹è¬—', 'ä¸­å‚·', 'ä¾®è¾±'];
            const mediumRiskWords = ['å•é¡Œ', 'æ‡¸å¿µ', 'ãƒªã‚¹ã‚¯', 'å±é™º', 'æ³¨æ„'];
            
            highRiskWords.forEach(word => {
                if (text.includes(word)) {
                    keywords.push({ word, level: 'high' });
                }
            });
            
            mediumRiskWords.forEach(word => {
                if (text.includes(word)) {
                    keywords.push({ word, level: 'medium' });
                }
            });
            
            return keywords;
        }

        // ç·åˆãƒªã‚¹ã‚¯è©•ä¾¡ã®è©³ç´°åˆ†æ
        function getDetailedRiskAssessment(riskScore) {
            const overall = riskScore.overall_score;
            const confidence = riskScore.confidence;
            
            if (overall >= 80) {
                return `ç·åˆã‚¹ã‚³ã‚¢${overall}/100ã¯æ¥µã‚ã¦é«˜ã„ãƒªã‚¹ã‚¯ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚åˆ†æä¿¡é ¼åº¦${confidence}%ã«åŸºã¥ãã€å³åº§ã®å¯¾å¿œãŒå¿…è¦ã§ã™ã€‚æŠ•ç¨¿ã¯ç‚ä¸Šæ‹¡æ•£ã®å¯èƒ½æ€§ãŒéå¸¸ã«é«˜ãã€ä¼æ¥­ã®ä¿¡é ¼æ€§ã«æ·±åˆ»ãªå½±éŸ¿ã‚’ä¸ãˆã‚‹å±é™ºæ€§ãŒã‚ã‚Šã¾ã™ã€‚`;
            } else if (overall >= 60) {
                return `ç·åˆã‚¹ã‚³ã‚¢${overall}/100ã¯é«˜ã„ãƒªã‚¹ã‚¯ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚åˆ†æä¿¡é ¼åº¦${confidence}%ã«åŸºã¥ãã€æ…é‡ãªæ¤œè¨ã¨é©åˆ‡ãªå¯¾å¿œãŒæ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚æŠ•ç¨¿å‰ã«å†…å®¹ã®è¦‹ç›´ã—ã‚’å¼·ãæ¨å¥¨ã—ã¾ã™ã€‚`;
            } else if (overall >= 40) {
                return `ç·åˆã‚¹ã‚³ã‚¢${overall}/100ã¯ä¸­ç¨‹åº¦ã®ãƒªã‚¹ã‚¯ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚åˆ†æä¿¡é ¼åº¦${confidence}%ã«åŸºã¥ãã€ä¸€éƒ¨ã®è¡¨ç¾ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚æŠ•ç¨¿å‰ã«è»½å¾®ãªä¿®æ­£ã‚’æ¤œè¨ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚`;
            } else {
                return `ç·åˆã‚¹ã‚³ã‚¢${overall}/100ã¯ä½ã„ãƒªã‚¹ã‚¯ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚åˆ†æä¿¡é ¼åº¦${confidence}%ã«åŸºã¥ãã€ç¾çŠ¶ã§ã¯å¤§ããªå•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ç¶™ç¶šçš„ãªãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ãŒé‡è¦ã§ã™ã€‚`;
            }
        }

        // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒªã‚¹ã‚¯åˆ†æ
        function getContentRiskAnalysis(text, riskScore) {
            const contentRisk = riskScore.content_risk;
            const issues = [];
            
            if (text.includes('å·®åˆ¥') || text.includes('åè¦‹')) {
                issues.push('å·®åˆ¥çš„è¡¨ç¾ãŒå«ã¾ã‚Œã¦ã„ã¾ã™');
            }
            if (text.includes('æ”»æ’ƒ') || text.includes('æš´åŠ›çš„')) {
                issues.push('æ”»æ’ƒçš„ã¾ãŸã¯æš´åŠ›çš„ãªè¡¨ç¾ãŒå«ã¾ã‚Œã¦ã„ã¾ã™');
            }
            if (text.includes('ä¸é©åˆ‡') || text.includes('å•é¡Œ')) {
                issues.push('ä¸é©åˆ‡ãªè¡¨ç¾ãŒå«ã¾ã‚Œã¦ã„ã¾ã™');
            }
            if (text.includes('èª¹è¬—') || text.includes('ä¸­å‚·')) {
                issues.push('èª¹è¬—ä¸­å‚·ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™');
            }
            
            if (contentRisk >= 80) {
                return `ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢${contentRisk}/100ã¯æ¥µã‚ã¦é«˜ã„å±é™ºæ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚${issues.length > 0 ? issues.join('ã€') + 'ã€‚' : ''}æŠ•ç¨¿å†…å®¹ã¯ç¤¾ä¼šçš„ã«å•é¡Œã¨ãªã‚‹å¯èƒ½æ€§ãŒéå¸¸ã«é«˜ãã€å³åº§ã®ä¿®æ­£ãŒå¿…è¦ã§ã™ã€‚`;
            } else if (contentRisk >= 60) {
                return `ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢${contentRisk}/100ã¯é«˜ã„å±é™ºæ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚${issues.length > 0 ? issues.join('ã€') + 'ã€‚' : ''}è¡¨ç¾ã®è¦‹ç›´ã—ã‚’å¼·ãæ¨å¥¨ã—ã¾ã™ã€‚`;
            } else if (contentRisk >= 40) {
                return `ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢${contentRisk}/100ã¯ä¸­ç¨‹åº¦ã®å±é™ºæ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚${issues.length > 0 ? issues.join('ã€') + 'ã€‚' : ''}ä¸€éƒ¨ã®è¡¨ç¾ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚`;
            } else {
                return `ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢${contentRisk}/100ã¯ä½ã„å±é™ºæ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ç¾çŠ¶ã§ã¯å¤§ããªå•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€è¡¨ç¾ã®é©åˆ‡æ€§ã‚’ç¶™ç¶šçš„ã«ç¢ºèªã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚`;
            }
        }

        // æ³•çš„ãƒªã‚¹ã‚¯åˆ†æ
        function getLegalRiskAnalysis(text, riskScore) {
            const legalRisk = riskScore.legal_risk;
            const legalIssues = [];
            
            if (text.includes('åèª‰') || text.includes('ä¾®è¾±')) {
                legalIssues.push('åèª‰æ¯€æã‚„ä¾®è¾±ç½ªã®å¯èƒ½æ€§');
            }
            if (text.includes('å·®åˆ¥') || text.includes('åè¦‹')) {
                legalIssues.push('å·®åˆ¥ç¦æ­¢æ³•é•åã®å¯èƒ½æ€§');
            }
            if (text.includes('å€‹äººæƒ…å ±') || text.includes('ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼')) {
                legalIssues.push('å€‹äººæƒ…å ±ä¿è­·æ³•é•åã®å¯èƒ½æ€§');
            }
            
            if (legalRisk >= 80) {
                return `æ³•çš„ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢${legalRisk}/100ã¯æ¥µã‚ã¦é«˜ã„æ³•çš„è²¬ä»»ã®å¯èƒ½æ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚${legalIssues.length > 0 ? legalIssues.join('ã€') + 'ãŒæ‡¸å¿µã•ã‚Œã¾ã™ã€‚' : ''}æ³•å‹™éƒ¨é–€ã¨ã®ç·Šæ€¥ç›¸è«‡ã‚’å¼·ãæ¨å¥¨ã—ã¾ã™ã€‚`;
            } else if (legalRisk >= 60) {
                return `æ³•çš„ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢${legalRisk}/100ã¯é«˜ã„æ³•çš„è²¬ä»»ã®å¯èƒ½æ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚${legalIssues.length > 0 ? legalIssues.join('ã€') + 'ãŒæ‡¸å¿µã•ã‚Œã¾ã™ã€‚' : ''}æŠ•ç¨¿å‰ã®æ³•å‹™ç¢ºèªã‚’æ¨å¥¨ã—ã¾ã™ã€‚`;
            } else if (legalRisk >= 40) {
                return `æ³•çš„ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢${legalRisk}/100ã¯ä¸­ç¨‹åº¦ã®æ³•çš„è²¬ä»»ã®å¯èƒ½æ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚${legalIssues.length > 0 ? legalIssues.join('ã€') + 'ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚' : ''}ç¶™ç¶šçš„ãªæ³•å‹™ç›£è¦–ãŒé‡è¦ã§ã™ã€‚`;
            } else {
                return `æ³•çš„ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢${legalRisk}/100ã¯ä½ã„æ³•çš„è²¬ä»»ã®å¯èƒ½æ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ç¾çŠ¶ã§ã¯å¤§ããªæ³•çš„å•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€æ³•çš„ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ã®ç¶™ç¶šçš„ãªç¢ºèªãŒé‡è¦ã§ã™ã€‚`;
            }
        }

        // ãƒ–ãƒ©ãƒ³ãƒ‰ãƒªã‚¹ã‚¯åˆ†æ
        function getBrandRiskAnalysis(text, riskScore) {
            const brandRisk = riskScore.brand_risk;
            const brandIssues = [];
            
            if (text.includes('ä¼æ¥­') || text.includes('ä¼šç¤¾')) {
                brandIssues.push('ä¼æ¥­ã‚¤ãƒ¡ãƒ¼ã‚¸ã¸ã®ç›´æ¥çš„ãªå½±éŸ¿');
            }
            if (text.includes('é¡§å®¢') || text.includes('ãŠå®¢æ§˜')) {
                brandIssues.push('é¡§å®¢é–¢ä¿‚ã¸ã®å½±éŸ¿');
            }
            if (text.includes('ãƒ–ãƒ©ãƒ³ãƒ‰') || text.includes('ä¿¡é ¼')) {
                brandIssues.push('ãƒ–ãƒ©ãƒ³ãƒ‰ä¿¡é ¼æ€§ã¸ã®å½±éŸ¿');
            }
            
            if (brandRisk >= 80) {
                return `ãƒ–ãƒ©ãƒ³ãƒ‰ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢${brandRisk}/100ã¯æ¥µã‚ã¦é«˜ã„ãƒ–ãƒ©ãƒ³ãƒ‰æ¯€æã®å¯èƒ½æ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚${brandIssues.length > 0 ? brandIssues.join('ã€') + 'ãŒæ‡¸å¿µã•ã‚Œã¾ã™ã€‚' : ''}ä¼æ¥­ã®ä¿¡é ¼æ€§ã«æ·±åˆ»ãªæ‰“æ’ƒã‚’ä¸ãˆã‚‹å±é™ºæ€§ãŒã‚ã‚Šã¾ã™ã€‚`;
            } else if (brandRisk >= 60) {
                return `ãƒ–ãƒ©ãƒ³ãƒ‰ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢${brandRisk}/100ã¯é«˜ã„ãƒ–ãƒ©ãƒ³ãƒ‰æ¯€æã®å¯èƒ½æ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚${brandIssues.length > 0 ? brandIssues.join('ã€') + 'ãŒæ‡¸å¿µã•ã‚Œã¾ã™ã€‚' : ''}åºƒå ±æˆ¦ç•¥ã®è¦‹ç›´ã—ãŒå¿…è¦ã§ã™ã€‚`;
            } else if (brandRisk >= 40) {
                return `ãƒ–ãƒ©ãƒ³ãƒ‰ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢${brandRisk}/100ã¯ä¸­ç¨‹åº¦ã®ãƒ–ãƒ©ãƒ³ãƒ‰æ¯€æã®å¯èƒ½æ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚${brandIssues.length > 0 ? brandIssues.join('ã€') + 'ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚' : ''}ãƒ–ãƒ©ãƒ³ãƒ‰ç›£è¦–ã®å¼·åŒ–ã‚’æ¨å¥¨ã—ã¾ã™ã€‚`;
            } else {
                return `ãƒ–ãƒ©ãƒ³ãƒ‰ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢${brandRisk}/100ã¯ä½ã„ãƒ–ãƒ©ãƒ³ãƒ‰æ¯€æã®å¯èƒ½æ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ç¾çŠ¶ã§ã¯å¤§ããªãƒ–ãƒ©ãƒ³ãƒ‰å½±éŸ¿ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ç¶™ç¶šçš„ãªãƒ–ãƒ©ãƒ³ãƒ‰ç›£è¦–ãŒé‡è¦ã§ã™ã€‚`;
            }
        }

        // ç¤¾ä¼šçš„ãƒªã‚¹ã‚¯åˆ†æ
        function getSocialRiskAnalysis(text, riskScore) {
            const socialRisk = riskScore.social_risk;
            const socialIssues = [];
            
            if (text.includes('ç¤¾ä¼š') || text.includes('ä¸–è«–')) {
                socialIssues.push('ç¤¾ä¼šå•é¡ŒåŒ–ã®å¯èƒ½æ€§');
            }
            if (text.includes('ç‚ä¸Š') || text.includes('æ‹¡æ•£')) {
                socialIssues.push('ç‚ä¸Šæ‹¡æ•£ã®å¯èƒ½æ€§');
            }
            if (text.includes('SNS') || text.includes('ã‚½ãƒ¼ã‚·ãƒ£ãƒ«')) {
                socialIssues.push('SNSã§ã®æ‹¡æ•£ãƒªã‚¹ã‚¯');
            }
            
            if (socialRisk >= 80) {
                return `ç¤¾ä¼šçš„ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢${socialRisk}/100ã¯æ¥µã‚ã¦é«˜ã„ç¤¾ä¼šå•é¡ŒåŒ–ã®å¯èƒ½æ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚${socialIssues.length > 0 ? socialIssues.join('ã€') + 'ãŒæ‡¸å¿µã•ã‚Œã¾ã™ã€‚' : ''}SNSç­‰ã§ã®æ€¥é€Ÿãªæ‹¡æ•£ã«ã‚ˆã‚Šã€å¤§ããªç¤¾ä¼šå•é¡Œã«ç™ºå±•ã™ã‚‹å±é™ºæ€§ãŒã‚ã‚Šã¾ã™ã€‚`;
            } else if (socialRisk >= 60) {
                return `ç¤¾ä¼šçš„ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢${socialRisk}/100ã¯é«˜ã„ç¤¾ä¼šå•é¡ŒåŒ–ã®å¯èƒ½æ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚${socialIssues.length > 0 ? socialIssues.join('ã€') + 'ãŒæ‡¸å¿µã•ã‚Œã¾ã™ã€‚' : ''}SNSç›£è¦–ä½“åˆ¶ã®å¼·åŒ–ãŒå¿…è¦ã§ã™ã€‚`;
            } else if (socialRisk >= 40) {
                return `ç¤¾ä¼šçš„ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢${socialRisk}/100ã¯ä¸­ç¨‹åº¦ã®ç¤¾ä¼šå•é¡ŒåŒ–ã®å¯èƒ½æ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚${socialIssues.length > 0 ? socialIssues.join('ã€') + 'ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚' : ''}ç¶™ç¶šçš„ãªç¤¾ä¼šå‹•å‘ã®ç›£è¦–ãŒé‡è¦ã§ã™ã€‚`;
            } else {
                return `ç¤¾ä¼šçš„ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢${socialRisk}/100ã¯ä½ã„ç¤¾ä¼šå•é¡ŒåŒ–ã®å¯èƒ½æ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ç¾çŠ¶ã§ã¯å¤§ããªç¤¾ä¼šçš„å½±éŸ¿ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ç¶™ç¶šçš„ãªç¤¾ä¼šå‹•å‘ã®ç›£è¦–ãŒé‡è¦ã§ã™ã€‚`;
            }
        }

        // ãƒªã‚¹ã‚¯è¦å› ã®åˆ†æ
        function analyzeRiskFactors(text, riskScore) {
            const factors = [];
            
            if (text.includes('å·®åˆ¥') || text.includes('åè¦‹')) {
                factors.push('å·®åˆ¥çš„è¡¨ç¾ã®ä½¿ç”¨');
            }
            if (text.includes('æ”»æ’ƒ') || text.includes('æš´åŠ›çš„')) {
                factors.push('æ”»æ’ƒçš„ã¾ãŸã¯æš´åŠ›çš„ãªè¡¨ç¾');
            }
            if (text.includes('ä¸é©åˆ‡') || text.includes('å•é¡Œ')) {
                factors.push('ä¸é©åˆ‡ãªè¡¨ç¾ã®ä½¿ç”¨');
            }
            if (text.includes('èª¹è¬—') || text.includes('ä¸­å‚·')) {
                factors.push('èª¹è¬—ä¸­å‚·ã®å¯èƒ½æ€§');
            }
            if (text.includes('ä¾®è¾±') || text.includes('è»½è¦–')) {
                factors.push('ä¾®è¾±çš„ãªè¡¨ç¾');
            }
            if (text.includes('ä¼æ¥­') || text.includes('ä¼šç¤¾')) {
                factors.push('ä¼æ¥­ãƒ–ãƒ©ãƒ³ãƒ‰ã¸ã®å½±éŸ¿');
            }
            if (text.includes('ç¤¾ä¼š') || text.includes('ä¸–è«–')) {
                factors.push('ç¤¾ä¼šçš„å½±éŸ¿ã®å¯èƒ½æ€§');
            }
            
            // ã‚¹ã‚³ã‚¢ã«åŸºã¥ãè¿½åŠ è¦å› 
            if (riskScore.overall_score >= 80) {
                factors.push('æ¥µã‚ã¦é«˜ã„ç‚ä¸Šãƒªã‚¹ã‚¯');
                factors.push('å³åº§ã®å¯¾å¿œãŒå¿…è¦');
            } else if (riskScore.overall_score >= 60) {
                factors.push('é«˜ã„ç‚ä¸Šãƒªã‚¹ã‚¯');
                factors.push('æ…é‡ãªæ¤œè¨ãŒå¿…è¦');
            }
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¦å› 
            if (factors.length === 0) {
                factors.push('è¡¨ç¾ã®é©åˆ‡æ€§ã®æ¤œè¨¼ãŒå¿…è¦');
                factors.push('æ½œåœ¨çš„ãƒªã‚¹ã‚¯ã®è©•ä¾¡ãŒå¿…è¦');
            }
            
            return factors;
        }

        // ã‚«ãƒ†ã‚´ãƒªã®èª¬æ˜
        function getCategoryExplanation(category) {
            const explanations = {
                'å·®åˆ¥çš„è¡¨ç¾': 'ç‰¹å®šã®å±æ€§ã‚„ã‚°ãƒ«ãƒ¼ãƒ—ã«å¯¾ã™ã‚‹å·®åˆ¥çš„ãªè¡¨ç¾ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ç¤¾ä¼šçš„ã«å•é¡Œã¨ãªã‚‹å¯èƒ½æ€§ãŒé«˜ãã€æ³•çš„è²¬ä»»ã‚‚å•ã‚ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚',
                'èª¹è¬—ä¸­å‚·': 'å€‹äººã‚„å›£ä½“ã«å¯¾ã™ã‚‹èª¹è¬—ä¸­å‚·ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚åèª‰æ¯€æç½ªã‚„ä¾®è¾±ç½ªã«å•ã‚ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚',
                'å€‹äººæƒ…å ±æ¼æ´©': 'å€‹äººæƒ…å ±ã®æ¼æ´©ã‚„ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã®ä¾µå®³ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚å€‹äººæƒ…å ±ä¿è­·æ³•é•åã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚',
                'åŠ´åƒå•é¡Œ': 'åŠ´åƒç’°å¢ƒã‚„é›‡ç”¨ã«é–¢ã™ã‚‹å•é¡ŒãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚åŠ´åƒåŸºæº–æ³•é•åã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚',
                'ç¤¾ä¼šçš„è²¬ä»»ã®æ¬ å¦‚': 'ä¼æ¥­ã®ç¤¾ä¼šçš„è²¬ä»»ã«å¯¾ã™ã‚‹èªè­˜ãŒä¸è¶³ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚CSRï¼ˆä¼æ¥­ã®ç¤¾ä¼šçš„è²¬ä»»ï¼‰ã®è¦³ç‚¹ã‹ã‚‰å•é¡Œã¨ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚',
                'æƒ…å ±éš è”½': 'é‡è¦ãªæƒ…å ±ã®éš è”½ã‚„ä¸é€æ˜ãªå¯¾å¿œãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ä¼æ¥­ã®é€æ˜æ€§ã«å¯¾ã™ã‚‹ç–‘å•ã‚’æ‹›ãå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚',
                'ä¸é©åˆ‡ãªè¡¨ç¾': 'ç¤¾ä¼šçš„ã«ä¸é©åˆ‡ã¨ã•ã‚Œã‚‹è¡¨ç¾ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ä¼æ¥­ã®ä¿¡é ¼æ€§ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚',
                'ä¸è¬¹æ…ãªè¡¨ç¾': 'ä¸è¬¹æ…ã§é…æ…®ã«æ¬ ã‘ã‚‹è¡¨ç¾ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ç¤¾ä¼šçš„ãªæ‰¹åˆ¤ã‚’æ‹›ãå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚',
                'ç¤¾ä¼šå•é¡Œã¸ã®åè¦‹': 'ç¤¾ä¼šå•é¡Œã«å¯¾ã™ã‚‹åè¦‹ã‚„åã£ãŸè¦‹è§£ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚ç¤¾ä¼šã®å¤šæ§˜æ€§ã«å¯¾ã™ã‚‹ç†è§£ä¸è¶³ã‚’ç¤ºã™å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚',
                'è¶£å‘³å—œå¥½ã¸ã®å·®åˆ¥': 'ç‰¹å®šã®è¶£å‘³ã‚„å—œå¥½ã«å¯¾ã™ã‚‹å·®åˆ¥çš„ãªè¡¨ç¾ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚å€‹äººã®è‡ªç”±ãªé¸æŠã«å¯¾ã™ã‚‹å°Šé‡ãŒä¸è¶³ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚'
            };
            return explanations[category] || 'æŠ•ç¨¿å†…å®¹ã«å•é¡Œã¨ãªã‚‹è¦ç´ ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚';
        }

        // é¡ä¼¼äº‹ä¾‹ã¨ã®æ¯”è¼ƒ
        function getCaseComparison(relatedCases) {
            if (relatedCases.length === 0) {
                return 'é¡ä¼¼ã™ã‚‹ç‚ä¸Šäº‹ä¾‹ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ãŸã ã—ã€æŠ•ç¨¿å†…å®¹ã®ç‰¹å¾´ã‹ã‚‰ã€éå»ã®ç‚ä¸Šäº‹ä¾‹ã¨åŒæ§˜ã®ãƒªã‚¹ã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå­˜åœ¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚';
            }
            
            const caseCount = relatedCases.length;
            const categories = [...new Set(relatedCases.map(case_ => case_.cause_category))];
            const avgImpact = relatedCases.reduce((sum, case_) => sum + (case_.social_impact_score || 50), 0) / caseCount;
            
            return `éå»ã®${caseCount}ä»¶ã®é¡ä¼¼ç‚ä¸Šäº‹ä¾‹ã‚’åˆ†æã—ãŸçµæœã€${categories.join('ã€')}ãªã©ã®åŸå› ã‚«ãƒ†ã‚´ãƒªãŒç¢ºèªã•ã‚Œã¾ã—ãŸã€‚å¹³å‡çš„ãªç¤¾ä¼šçš„å½±éŸ¿åº¦ã¯${Math.round(avgImpact)}/100ã§ã€${avgImpact >= 70 ? 'é«˜ã„' : avgImpact >= 50 ? 'ä¸­ç¨‹åº¦ã®' : 'ä½ã„'}å½±éŸ¿ãŒäºˆæƒ³ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚‰ã®äº‹ä¾‹ã®çµæœã‚’å‚è€ƒã«ã€é©åˆ‡ãªå¯¾å¿œç­–ã‚’è¬›ã˜ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚`;
        }


        // ä¿®æ­£æ¡ˆã®ææ¡ˆ
        function getRevisionSuggestion(text, riskScore) {
            const overallRisk = riskScore.overall_score;
            
            if (overallRisk >= 80) {
                return `ç·åˆã‚¹ã‚³ã‚¢${overallRisk}/100ã¯æ¥µã‚ã¦é«˜ã„ãƒªã‚¹ã‚¯ã‚’ç¤ºã—ã¦ã„ã‚‹ãŸã‚ã€æŠ•ç¨¿å†…å®¹ã®å…¨é¢çš„ãªè¦‹ç›´ã—ãŒå¿…è¦ã§ã™ã€‚å·®åˆ¥çš„ã€æ”»æ’ƒçš„ã€ã¾ãŸã¯ä¸é©åˆ‡ãªè¡¨ç¾ã‚’å®Œå…¨ã«é™¤å»ã—ã€ã‚ˆã‚Šå»ºè¨­çš„ã§é©åˆ‡ãªè¡¨ç¾ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã‚’å¼·ãæ¨å¥¨ã—ã¾ã™ã€‚å…·ä½“çš„ãªä¿®æ­£æ¡ˆã«ã¤ã„ã¦ã¯ã€æ³•å‹™éƒ¨é–€ã‚„PRå°‚é–€å®¶ã¨ã®ç›¸è«‡ã‚’æ¨å¥¨ã—ã¾ã™ã€‚`;
            } else if (overallRisk >= 60) {
                return `ç·åˆã‚¹ã‚³ã‚¢${overallRisk}/100ã¯é«˜ã„ãƒªã‚¹ã‚¯ã‚’ç¤ºã—ã¦ã„ã‚‹ãŸã‚ã€æŠ•ç¨¿å†…å®¹ã®ä¸€éƒ¨ä¿®æ­£ãŒå¿…è¦ã§ã™ã€‚å•é¡Œã¨ãªã‚‹è¡¨ç¾ã‚’ç‰¹å®šã—ã€ã‚ˆã‚Šé©åˆ‡ã§å»ºè¨­çš„ãªè¡¨ç¾ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚ä¿®æ­£å¾Œã¯å†åº¦ãƒªã‚¹ã‚¯åˆ†æã‚’è¡Œã†ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚`;
            } else if (overallRisk >= 40) {
                return `ç·åˆã‚¹ã‚³ã‚¢${overallRisk}/100ã¯ä¸­ç¨‹åº¦ã®ãƒªã‚¹ã‚¯ã‚’ç¤ºã—ã¦ã„ã‚‹ãŸã‚ã€è»½å¾®ãªä¿®æ­£ã‚’æ¤œè¨ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚ä¸€éƒ¨ã®è¡¨ç¾ã‚’ã‚ˆã‚Šé©åˆ‡ãªã‚‚ã®ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã§ã€ãƒªã‚¹ã‚¯ã‚’ã•ã‚‰ã«ä½æ¸›ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`;
            } else {
                return `ç·åˆã‚¹ã‚³ã‚¢${overallRisk}/100ã¯ä½ã„ãƒªã‚¹ã‚¯ã‚’ç¤ºã—ã¦ã„ã‚‹ãŸã‚ã€ç¾çŠ¶ã§ã¯å¤§ããªä¿®æ­£ã¯ä¸è¦ã§ã™ã€‚ãŸã ã—ã€ã‚ˆã‚Šå®‰å…¨ãªè¡¨ç¾ã«å¤‰æ›´ã™ã‚‹ã“ã¨ã§ã€ãƒªã‚¹ã‚¯ã‚’ã•ã‚‰ã«ä½æ¸›ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`;
            }
        }

        // çµè«–
        function getConclusion(riskScore) {
            const overallRisk = riskScore.overall_score;
            const confidence = riskScore.confidence;
            
            if (overallRisk >= 80) {
                return `ã“ã®æŠ•ç¨¿ã¯ã€ç·åˆã‚¹ã‚³ã‚¢${overallRisk}/100ã¨ã„ã†æ¥µã‚ã¦é«˜ã„ãƒªã‚¹ã‚¯ã‚’å­•ã‚“ã§ã„ã¾ã™ã€‚åˆ†æä¿¡é ¼åº¦${confidence}%ã«åŸºã¥ãã€å³åº§ã®å¯¾å¿œãŒå¿…è¦ã§ã™ã€‚è¿…é€Ÿã‹ã¤é©åˆ‡ãªå¯¾å¿œã‚’è¡Œã†ã“ã¨ãŒã€ä¼æ¥­ã®å­˜ç¶šã«é–¢ã‚ã‚‹é‡å¤§ãªå•é¡Œã§ã™ã€‚æŠ•ç¨¿ã®å‰Šé™¤ã€è¬ç½ªæ–‡ã®ç™ºè¡¨ã€å†ç™ºé˜²æ­¢ç­–ã®ç­–å®šãªã©ã€åŒ…æ‹¬çš„ãªå¯¾å¿œãŒæ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚`;
            } else if (overallRisk >= 60) {
                return `ã“ã®æŠ•ç¨¿ã¯ã€ç·åˆã‚¹ã‚³ã‚¢${overallRisk}/100ã¨ã„ã†é«˜ã„ãƒªã‚¹ã‚¯ã‚’å­•ã‚“ã§ã„ã¾ã™ã€‚åˆ†æä¿¡é ¼åº¦${confidence}%ã«åŸºã¥ãã€æ…é‡ãªæ¤œè¨ã¨é©åˆ‡ãªå¯¾å¿œãŒæ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚æŠ•ç¨¿å‰ã®å†…å®¹è¦‹ç›´ã—ã€æ³•å‹™ç¢ºèªã€åºƒå ±æˆ¦ç•¥ã®æ¤œè¨ãªã©ã€ãƒªã‚¹ã‚¯ã‚’æœ€å°åŒ–ã™ã‚‹ãŸã‚ã®å¯¾ç­–ãŒé‡è¦ã§ã™ã€‚`;
            } else if (overallRisk >= 40) {
                return `ã“ã®æŠ•ç¨¿ã¯ã€ç·åˆã‚¹ã‚³ã‚¢${overallRisk}/100ã¨ã„ã†ä¸­ç¨‹åº¦ã®ãƒªã‚¹ã‚¯ã‚’å­•ã‚“ã§ã„ã¾ã™ã€‚åˆ†æä¿¡é ¼åº¦${confidence}%ã«åŸºã¥ãã€ä¸€éƒ¨ã®è¡¨ç¾ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚è»½å¾®ãªä¿®æ­£ã«ã‚ˆã‚Šã€ãƒªã‚¹ã‚¯ã‚’ã•ã‚‰ã«ä½æ¸›ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ç¶™ç¶šçš„ãªãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã¨é©åˆ‡ãªå¯¾å¿œãŒé‡è¦ã§ã™ã€‚`;
            } else {
                return `ã“ã®æŠ•ç¨¿ã¯ã€ç·åˆã‚¹ã‚³ã‚¢${overallRisk}/100ã¨ã„ã†ä½ã„ãƒªã‚¹ã‚¯ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚åˆ†æä¿¡é ¼åº¦${confidence}%ã«åŸºã¥ãã€ç¾çŠ¶ã§ã¯å¤§ããªå•é¡Œã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ç¶™ç¶šçš„ãªãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã¨é©åˆ‡ãªå¯¾å¿œãŒé‡è¦ã§ã™ã€‚ä¼æ¥­ã®ä¿¡é ¼æ€§ç¶­æŒã¨ãƒªã‚¹ã‚¯ç®¡ç†ã«ãŠã„ã¦ã€äºˆé˜²çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ç¶™ç¶šã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚`;
            }
        }

        // é–¢é€£äº‹ä¾‹ã®è¡¨ç¤º
        function displayRelatedCases(cases, riskLevel) {
            if (cases.length === 0) {
                if (riskLevel === 'æŠ•ç¨¿å¯') {
                    relatedCasesTitle.textContent = 'å®‰å…¨ãªæŠ•ç¨¿ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹';
                    relatedCasesList.innerHTML = `
                        <div class="case-item">
                            <div class="case-title">é©åˆ‡ãªè¡¨ç¾ã®ä½¿ç”¨</div>
                            <div class="case-description">ç¾åœ¨ã®å†…å®¹ã¯é©åˆ‡ãªè¡¨ç¾ãŒä½¿ç”¨ã•ã‚Œã¦ãŠã‚Šã€å®‰å…¨ã«æŠ•ç¨¿ã§ãã¾ã™ã€‚ä»Šå¾Œã‚‚ã“ã®ã‚ˆã†ãªé…æ…®ã®ã‚ã‚‹è¡¨ç¾ã‚’å¿ƒãŒã‘ã¦ãã ã•ã„ã€‚</div>
                        </div>
                        <div class="case-item">
                            <div class="case-title">ç¶™ç¶šçš„ãªãƒªã‚¹ã‚¯ç®¡ç†</div>
                            <div class="case-description">å®šæœŸçš„ãªãƒªã‚¹ã‚¯åˆ†æã«ã‚ˆã‚Šã€æŠ•ç¨¿å‰ã®ãƒã‚§ãƒƒã‚¯ä½“åˆ¶ã‚’ç¶­æŒã—ã€å®‰å…¨ãªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¶™ç¶šã—ã¾ã—ã‚‡ã†ã€‚</div>
                        </div>
                    `;
                } else {
                    relatedCasesList.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: var(--space-8);">é–¢é€£ã™ã‚‹é¡ä¼¼äº‹ä¾‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
                }
                return;
            }

            relatedCasesList.innerHTML = cases.map(case_ => `
                <div class="case-item">
                    <div class="case-title">${case_.title}</div>
                    <div class="case-meta">
                        <i class="fas fa-calendar"></i> ${case_.incident_date} | 
                        <i class="fas fa-building"></i> ${case_.company_info || 'ä¸æ˜'}
                    </div>
                    <div class="case-description">${case_.reasoning_text}</div>
                </div>
            `).join('');
        }

        // ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‹ã‚‰HTMLã¸ã®å¤‰æ›
        function convertMarkdownToHtml(markdown) {
            if (!markdown) return '';
            
            let html = markdown;
            
            // è¦‹å‡ºã—ã®å¤‰æ›
            html = html.replace(/^## (.*$)/gm, '<h3>$1</h3>');
            html = html.replace(/^### (.*$)/gm, '<h4>$1</h4>');
            
            // å¤ªå­—ã®å¤‰æ›
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã®å¤‰æ›
            html = html.replace(/^(\s*)\* (.*$)/gm, '$1<li>$2</li>');
            html = html.replace(/^(\s*)- (.*$)/gm, '$1<li>$2</li>');
            
            // æ®µè½ã«åˆ†å‰²
            const lines = html.split('\n');
            let result = '';
            let inList = false;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                if (!line) {
                    if (inList) {
                        result += '</ul>';
                        inList = false;
                    }
                    continue;
                }
                
                if (line.startsWith('<h3') || line.startsWith('<h4')) {
                    if (inList) {
                        result += '</ul>';
                        inList = false;
                    }
                    result += line;
                } else if (line.startsWith('<li>')) {
                    if (!inList) {
                        result += '<ul>';
                        inList = true;
                    }
                    result += line;
                } else {
                    if (inList) {
                        result += '</ul>';
                        inList = false;
                    }
                    result += '<p>' + line + '</p>';
                }
            }
            
            if (inList) {
                result += '</ul>';
            }
            
            return result;
        }

        // çµæœã®è¡¨ç¤º
        function displayResult(data) {
            // ã‚¹ã‚³ã‚¢è¡¨ç¤ºã®æ›´æ–°
            updateScoreCircle(data.risk_score.overall_score);
            displayRiskLevel(data.risk_level, data.recommendation);
            displayDetailedScores(data.risk_score);
            displayRecommendations(data.recommendations);
            displayAnalysisText(data.analysis_text, data.risk_score, data.related_cases);
            displayRelatedCases(data.related_cases, data.risk_level);
            
            // çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤º
            resultSection.style.display = 'block';
            resultSection.classList.add('fade-in');
        }

        // åˆ†æå®Ÿè¡Œ
        analyzeBtn.addEventListener('click', async function() {
            const text = textInput.value.trim();
            
            if (!text) {
                showError('ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            if (text.length < 5) {
                showError('ãƒ†ã‚­ã‚¹ãƒˆã¯5æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            setLoading(true);
            hideError();
            hideResult();
            
            try {
                // Vercel APIã‚’å‘¼ã³å‡ºã—
                const response = await fetch('/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text: text })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«ã‚’è¨ˆç®—
                const riskLevel = data.risk_score.overall_score >= 70 ? 'æŠ•ç¨¿å±é™º' : 
                                 data.risk_score.overall_score >= 40 ? 'è¦ãƒ¬ãƒ“ãƒ¥ãƒ¼' : 'æŠ•ç¨¿å¯';
                
                // æ¨å¥¨äº‹é …ã‚’ç”Ÿæˆ
                const recommendations = [];
                if (data.risk_score.overall_score >= 70) {
                    recommendations.push('æŠ•ç¨¿ã‚’ä¸­æ­¢ã—ã€å†…å®¹ã®å…¨é¢çš„ãªè¦‹ç›´ã—ãŒå¿…è¦ã§ã™');
                    recommendations.push('æ³•å‹™éƒ¨é–€ã¨ã®ç·Šæ€¥ç›¸è«‡ã‚’æ¨å¥¨ã—ã¾ã™');
                    recommendations.push('è¬ç½ªæ–‡ã®æº–å‚™ã‚’æ¤œè¨ã—ã¦ãã ã•ã„');
                } else if (data.risk_score.overall_score >= 40) {
                    recommendations.push('æŠ•ç¨¿å‰ã®å†…å®¹è¦‹ç›´ã—ã‚’æ¨å¥¨ã—ã¾ã™');
                    recommendations.push('ä¸€éƒ¨ã®è¡¨ç¾ã‚’ä¿®æ­£ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„');
                    recommendations.push('åºƒå ±éƒ¨é–€ã¨ã®ç›¸è«‡ã‚’æ¨å¥¨ã—ã¾ã™');
                } else {
                    recommendations.push('ç¾åœ¨ã®å†…å®¹ã§å®‰å…¨ã«æŠ•ç¨¿ã§ãã¾ã™');
                    recommendations.push('ç¶™ç¶šçš„ãªãƒªã‚¹ã‚¯ç®¡ç†ã‚’å¿ƒãŒã‘ã¦ãã ã•ã„');
                }
                
                // è¡¨ç¤ºç”¨ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
                const displayData = {
                    ...data,
                    risk_level: riskLevel,
                    recommendations: recommendations
                };
                
                displayResult(displayData);
                
            } catch (error) {
                console.error('Error:', error);
                showError('ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚APIã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            } finally {
                setLoading(false);
            }
        });
    </script>
</body>
</html>